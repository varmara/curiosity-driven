<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="radix" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

  <!--radix_placeholder_meta_tags-->
  <title>Прыгающие орангутаны - ZIP модель</title>
  
  <meta property="description" itemprop="description" content="В этом посте будет Zero Inflated Poisson модель."/>
  
  
  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2018-12-28"/>
  <meta property="article:created" itemprop="dateCreated" content="2018-12-28"/>
  <meta name="article:author" content="Марина Варфоломеева"/>
  
  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="Прыгающие орангутаны - ZIP модель"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="В этом посте будет Zero Inflated Poisson модель."/>
  <meta property="og:locale" content="en_US"/>
  
  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="Прыгающие орангутаны - ZIP модель"/>
  <meta property="twitter:description" content="В этом посте будет Zero Inflated Poisson модель."/>
  
  <!--/radix_placeholder_meta_tags-->
  
  <meta name="citation_reference" content="citation_title=The ontogeny of gap crossing behaviour in bornean orangutans (pongo pygmaeus wurmbii);citation_publication_date=2015;citation_publisher=Public Library of Science;citation_volume=10;citation_author=Jackie Chappell;citation_author=Abigail C Phillips;citation_author=Maria A Noordwijk;citation_author=Tatang Mitra Setia;citation_author=Susannah KS Thorpe"/>
  <!--radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","categories","output","bibliography","csl","toc","draft"]}},"value":[{"type":"character","attributes":{},"value":["Прыгающие орангутаны - ZIP модель"]},{"type":"character","attributes":{},"value":["В этом посте будет Zero Inflated Poisson модель.\n"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name"]}},"value":[{"type":"character","attributes":{},"value":["Марина Варфоломеева"]}]}]},{"type":"character","attributes":{},"value":["12-28-2018"]},{"type":"character","attributes":{},"value":["ZIP"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["radix::radix_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained"]}},"value":[{"type":"logical","attributes":{},"value":[false]}]}]},{"type":"character","attributes":{},"value":["references.bib"]},{"type":"character","attributes":{},"value":["../../_bibs/apa-single-spaced.csl"]},{"type":"logical","attributes":{},"value":[true]},{"type":"logical","attributes":{},"value":[true]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["gap-crossing-orangutangs-zip-mv_files/bowser-1.9.3/bowser.min.js","gap-crossing-orangutangs-zip-mv_files/distill-2.2.21/template.v2.js","gap-crossing-orangutangs-zip-mv_files/figure-html5/dot-plot-1.png","gap-crossing-orangutangs-zip-mv_files/figure-html5/mod-pois-lme4-diag-1.png","gap-crossing-orangutangs-zip-mv_files/figure-html5/mod-pois-lme4-diag-2.png","gap-crossing-orangutangs-zip-mv_files/figure-html5/mod-pois-lme4-resid-1.png","gap-crossing-orangutangs-zip-mv_files/figure-html5/mod-pois-lme4-resid-categ-1.png","gap-crossing-orangutangs-zip-mv_files/figure-html5/mod-pois-predict-1.png","gap-crossing-orangutangs-zip-mv_files/figure-html5/mod-zip-admb-predict-1.png","gap-crossing-orangutangs-zip-mv_files/figure-html5/mod-zip-admb-resid-1.png","gap-crossing-orangutangs-zip-mv_files/figure-html5/mod-zip-admb-resid-2.png","gap-crossing-orangutangs-zip-mv_files/figure-html5/mod-zip-admb-resid-3.png","gap-crossing-orangutangs-zip-mv_files/figure-html5/mod-zip-admb-resid-4.png","gap-crossing-orangutangs-zip-mv_files/figure-html5/mod-zip-admb-resid-5.png","gap-crossing-orangutangs-zip-mv_files/figure-html5/mod-zip-admb-resid-6.png","gap-crossing-orangutangs-zip-mv_files/figure-html5/mod-zip-admb-resid-7.png","gap-crossing-orangutangs-zip-mv_files/figure-html5/mod-zip-tmb-diag-1.png","gap-crossing-orangutangs-zip-mv_files/figure-html5/mod-zip-tmb-diag-2.png","gap-crossing-orangutangs-zip-mv_files/figure-html5/mod-zip-tmb-diag-3.png","gap-crossing-orangutangs-zip-mv_files/figure-html5/mod-zip-tmb-diag-4.png","gap-crossing-orangutangs-zip-mv_files/figure-html5/mod-zip-tmb-diag-5.png","gap-crossing-orangutangs-zip-mv_files/figure-html5/mod-zip-tmb-diag-6.png","gap-crossing-orangutangs-zip-mv_files/figure-html5/mod-zip-tmb-predict-1.png","gap-crossing-orangutangs-zip-mv_files/figure-html5/mod-zip-tmb-predict-re-1.png","gap-crossing-orangutangs-zip-mv_files/figure-html5/mod-zip-tmb-resid-1.png","gap-crossing-orangutangs-zip-mv_files/figure-html5/response-by-subject-1.png","gap-crossing-orangutangs-zip-mv_files/figure-html5/unnamed-chunk-2-1.png","gap-crossing-orangutangs-zip-mv_files/figure-html5/unnamed-chunk-3-1.png","gap-crossing-orangutangs-zip-mv_files/figure-html5/unnamed-chunk-5-1.png","gap-crossing-orangutangs-zip-mv_files/figure-html5/unnamed-chunk-7-1.png","gap-crossing-orangutangs-zip-mv_files/figure-html5/unnamed-chunk-9-1.png","gap-crossing-orangutangs-zip-mv_files/figure-html5/zeros-1.png","gap-crossing-orangutangs-zip-mv_files/jquery-1.11.3/jquery.min.js","gap-crossing-orangutangs-zip-mv_files/webcomponents-2.0.0/webcomponents.js","references.bib"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->
  
  <style type="text/css">
  
  body {
    background-color: white;
  }
  
  .pandoc-table {
    width: 100%;
  }
  
  .pandoc-table>caption {
    margin-bottom: 10px;
  }
  
  .pandoc-table th:not([align]) {
    text-align: left;
  }
  
  .pagedtable-footer {
    font-size: 15px;
  }
  
  .html-widget {
    margin-bottom: 2.0em;
  }
  
  .l-screen-inset {
    padding-right: 16px;
  }
  
  .l-screen .caption {
    margin-left: 10px;
  }
  
  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .shaded .shaded-content {
    background: white;
  }
  
  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }
  
  .hidden {
    display: none !important;
  }
  
  d-article {
    padding-bottom: 30px;
  }
  
  d-appendix {
    padding-top: 30px;
  }
  
  d-article>p>img {
    width: 100%;
  }
  
  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }
  
  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }
  
  /* CSS for table of contents */
  
  .d-toc {
    color: rgba(0,0,0,0.8);
    font-size: 0.8em;
    line-height: 1em;
  }
  
  .d-toc-header {
    font-size: 0.6rem;
    font-weight: 400;
    color: rgba(0, 0, 0, 0.5);
    text-transform: uppercase;
    margin-top: 0;
    margin-bottom: 1.3em;
  }
  
  .d-toc a {
    border-bottom: none;
  }
  
  .d-toc ul {
    padding-left: 0;
  }
  
  .d-toc li>ul {
    padding-top: 0.8em;
    padding-left: 16px;
    margin-bottom: 0.6em;
  }
  
  .d-toc ul,
  .d-toc li {
    list-style-type: none;
  }
  
  .d-toc li {
    margin-bottom: 0.9em;
  }
  
  .d-toc-separator {
    margin-top: 20px;
    margin-bottom: 2em;
  }
  
  .d-article-with-toc {
    border-top: none;
    padding-top: 0;
  }
  
  
  
  /* Tweak code blocks (note that this CSS is repeated above in an injection
     into the d-code shadow dom) */
  
  d-code {
    overflow-x: auto !important;
  }
  
  pre.d-code code.d-code {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }
  
  pre.text-output {
  
    font-size: 12px;
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;
  
    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;
  
    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }
  
  @media(min-width: 768px) {
  
  d-code {
    overflow-x: visible !important;
  }
  
  pre.d-code code.d-code  {
      padding-left: 18px;
      font-size: 14px;
  }
  pre.text-output {
    font-size: 14px;
  }
  }
  
  /* Figure */
  
  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }
  
  .figure img {
    width: 100%;
  }
  
  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }
  
  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }
  
  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }
  
  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }
  
  
  
  /* Tweak 1000px media break to show more text */
  
  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }
  
    .grid {
      grid-column-gap: 16px;
    }
  
    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }
  
  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }
  
    .grid {
      grid-column-gap: 32px;
    }
  }
  
  
  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */
  
  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }
  
  
  /* Social footer */
  
  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }
  
  .disqus-comments {
    margin-right: 30px;
  }
  
  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }
  
  #disqus_thread {
    margin-top: 30px;
  }
  
  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }
  
  .article-sharing a:hover {
    border-bottom: none;
  }
  
  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }
  
  .subscribe p {
    margin-bottom: 0.5em;
  }
  
  
  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }
  
  
  /* Improve display for browsers without grid (IE/Edge <= 15) */
  
  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }
  
  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }
  
  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }
  
  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }
  
  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }
  
  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }
  
  
  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }
  
  .downlevel .footnotes ol {
    padding-left: 13px;
  }
  
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }
  
  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }
  
  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }
  
  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;
  
    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;
  
    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }
  
  </style>
  
  <script type="application/javascript">
  
  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }
  
  // show body when load is complete
  function on_load_complete() {
  
    // set body to visible
    document.body.style.visibility = 'visible';
  
    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }
  
    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }
  
  function init_distill() {
  
    init_common();
  
    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);
  
    // create d-title
    $('.d-title').changeElementType('d-title');
  
    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);
  
    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();
  
    // move posts container into article
    $('.posts-container').appendTo($('d-article'));
  
    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');
  
    // create d-bibliography
    var bibliography = $('<d-bibliography></d-bibliography>');
    $('#distill-bibliography').wrap(bibliography);
  
    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;
  
    // replace citations with <d-cite>
    $('.citation').each(function(i, val) {
      appendix = true;
      var cites = $(this).attr('data-cites').split(" ");
      var dt_cite = $('<d-cite></d-cite>');
      dt_cite.attr('key', cites.join());
      $(this).replaceWith(dt_cite);
    });
    // remove refs
    $('#refs').remove();
  
    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();
  
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-toc a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });
  
    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');
  
    // replace code blocks with d-code
    $('pre>code').each(function(i, val) {
      var code = $(this);
      var pre = code.parent();
      var clz = "";
      var language = pre.attr('class');
      if (language) {
        // map unknown languages to "clike" (without this they just dissapear)
        if ($.inArray(language, ["bash", "clike", "css", "go", "html",
                                 "javascript", "js", "julia", "lua", "markdown",
                                 "markup", "mathml", "python", "svg", "xml"]) == -1)
          language = "clike";
        language = ' language="' + language + '"';
        var dt_code = $('<d-code block' + language + clz + '></d-code>');
        dt_code.text(code.text());
        pre.replaceWith(dt_code);
      } else {
        code.addClass('text-output').unwrap().changeElementType('pre');
      }
    });
  
    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {
  
      // capture layout
      var layout = $(this).attr('data-layout');
  
      // apply layout to markdown level block elements
      var elements = $(this).children().not('d-code, pre.text-output, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });
  
  
      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });
  
    // load distill framework
    load_distill_framework();
  
    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {
  
      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;
  
      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');
  
      // table of contents
      if (have_authors) // adjust border if we are in authors
        $('.d-toc').parent().addClass('d-article-with-toc');
  
      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');
  
      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }
  
      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');
  
      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");
  
      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }
  
       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }
  
      // inject pre code styles (can't do this with a global stylesheet b/c a shadow root is used)
      $('d-code').each(function(i, val) {
        var style = document.createElement('style');
        style.innerHTML = 'pre code { padding-left: 10px; font-size: 12px; border-left: 2px solid rgba(0,0,0,0.1); } ' +
                          '@media(min-width: 768px) { pre code { padding-left: 18px; font-size: 14px; } }';
        if (this.shadowRoot)
          this.shadowRoot.appendChild(style);
      });
  
      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();
  
      // clear polling timer
      clearInterval(tid);
  
      // show body now that everything is ready
      on_load_complete();
    }
  
    var tid = setInterval(distill_post_process, 50);
    distill_post_process();
  
  }
  
  function init_downlevel() {
  
    init_common();
  
     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));
  
    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
  
    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();
  
    // remove toc
    $('.d-toc-header').remove();
    $('.d-toc').remove();
    $('.d-toc-separator').remove();
  
    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });
  
  
    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);
  
    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);
  
    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();
  
    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();
  
    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));
  
    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });
  
    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));
  
    $('body').addClass('downlevel');
  
    on_load_complete();
  }
  
  
  function init_common() {
  
    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};
  
        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });
  
        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);
  
    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});
  
    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });
  
      }
    });
  
    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });
  
    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.radix-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }
  
    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');
  
    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");
  
    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();
  
    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }
  
  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });
  
  </script>
  
  <!--/radix_placeholder_distill-->
  <script src="gap-crossing-orangutangs-zip-mv_files/jquery-1.11.3/jquery.min.js"></script>
  <script src="gap-crossing-orangutangs-zip-mv_files/bowser-1.9.3/bowser.min.js"></script>
  <script src="gap-crossing-orangutangs-zip-mv_files/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="gap-crossing-orangutangs-zip-mv_files/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Прыгающие орангутаны - ZIP модель","description":"В этом посте будет Zero Inflated Poisson модель.","authors":[{"author":"Марина Варфоломеева","authorURL":"#","affiliation":"&nbsp;","affiliationURL":"#"}],"publishedDate":"2018-12-28T00:00:00.000+03:00","citationText":"Варфоломеева, 2018"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Прыгающие орангутаны - ZIP модель</h1>
<p>В этом посте будет Zero Inflated Poisson модель.</p>
</div>

<div class="d-byline">
  Марина Варфоломеева  
  
<br/>12-28-2018
</div>

<div class="d-article">
<h3 class="d-toc-header">Table of Contents</h3>
<nav class="d-toc" id="TOC">

</nav>
<hr class="d-toc-separator"/>
<h2>Введение</h2>
<p>Анализ счетных величин при помощи обобщенных линейных моделей традиционно начинают с моделей, основанных на распределении Пуассона.</p>
<p><span class="math inline">\(y_i \sim Poisson(\mu_i)\)</span><br />
<span class="math inline">\(E(y_i) = \mu_i\)</span>, <span class="math inline">\(var(y_i) = \mu_i\)</span><br />
<span class="math inline">\(log(\mu_i) = \eta_i\)</span><br />
<span class="math inline">\(\eta_i = \beta_0 + \beta_1 x_{1i} + \ldots + \beta_{p - 1}x_{p - 1}\)</span></p>
<p>В случае, если данные не соответствуют свойствам этого распределения (дисперсия превышает мат.ожидание), может помочь использование отрицательного биномиального распределения. Дополнительный параметр <span class="math inline">\(k\)</span> позволяет описать эту избыточность дисперсии.</p>
<p><span class="math inline">\(y_i \sim NegBin(\mu_i, k)\)</span><br />
<span class="math inline">\(E(y_i) = \mu_i\)</span>, <span class="math inline">\(var(y_i) = \mu_i + \mu_i^2 / k\)</span><br />
<span class="math inline">\(log(\mu_i) = \eta_i\)</span><br />
<span class="math inline">\(\eta_i = \beta_0 + \beta_1 x_{1i} + \ldots + \beta_{p - 1}x_{p - 1}\)</span></p>
<p>В смешанных моделях к последней строке уравнений добавляются еще и случайные эффекты.</p>
<p>Одним из источников сверхдисперсии может быть слишком большое число нулей в исходных данных — больше, чем предсказывает выбранное распределение. В случае избыточности нулей применяют zero-inflated или zero-altered (hurdle) модели.</p>
<p>Как разные модели ведут себя с нулями?</p>
<p>В обычных моделях для счетных данных у нулей один единственный источник — само распределение Пуассона или отр. биномиальное.</p>
<p>В zero-inflated моделях используется <em>смесь распределений</em> — Биномиального и одного из обычных счетных распределений. Смесь распределений — это такое распределение-химера, которое за счет своей биномиальной части способно производить больше нулей, чем исходное счетное. Некоторое количество нулей по-прежнему производит счетная часть, а недостающие — биномиальная. Чаще всего используется Zero-inflated Poisson (ZIP).</p>
<p>В zero-altered (hurdle) моделях используется <em>два отдельных распределения</em>. Биномиальное распределение предсказывает, будет ли ноль или какое-то положительное значение. Eсли предскано положительное значение, подключается модифицированное распределение для счетных данных, от которого “отрезаны” нули (truncated-at-zero distribution), и предсказывает счет.</p>
<p>Проиллюстрировать работу этих моделей можно попробовать на данных из статьи о поведении орангутанов <span class="citation" data-cites="chappell2015ontogeny">(Chappell, Phillips, Noordwijk, Setia, &amp; Thorpe, <a href="#ref-chappell2015ontogeny">2015</a>)</span>. Авторы сразу подбирали ZIP модель, но оказалось, что ситуация может быть немного сложнее (или, вернее, проще).</p>
<h2 id="todo--">TODO: Описание данных</h2>
<h2 id="--">Подготовка к анализу</h2>
<p>Загружаем необходимые пакеты.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
# Для чтения данных
library(readxl)
# Для предобработки данных
library(tidyverse)
# Для графиков
library(cowplot)
library(ggplot2)
theme_set(theme_bw())
# Для смешанных моделей
library(lme4)
library(glmmADMB)
library(glmmTMB)
# Для вспомогательных тестов
library(sjstats)
# Для пост-хоков
library(emmeans)
# Для графиков коэффициентов
library(broom.mixed)
library(dotwhisker)</code></pre>
</div>
<p>Читаем данные и готовим их к анализу. В исходной таблице с сайта PlosOne нехватает информации о числе дней, которое наблюдали за каждым орангутаном, но они есть в одной из таблиц в тексте. Добавим их в датафрейм.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
gap &lt;- read_excel(&#39;../../_data/gap-crossing-behaviour-Chappell-et-al-2015.xlsx&#39;, 
                  sheet = 1, 
                  col_types = c(&quot;text&quot;, &quot;text&quot;, &quot;numeric&quot;, &quot;numeric&quot;, &quot;text&quot;, &quot;text&quot;))
# Переименовываем переменные
colnames(gap) &lt;- c(&quot;ID&quot;, &quot;age&quot;,&quot;forearm&quot;, &quot;AGC&quot;, &quot;behaviour&quot;, &quot;takeoff&quot;)

# Возраста орангутанов
ages =  c(&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;,&quot;5&quot;,&quot;6&quot;,&quot;7&quot;,&quot;8&quot;,&quot;9&quot;,&quot;10&quot;,&quot;11&quot;,&quot;AF&quot;,&quot;AM&quot;)
# Порядок имен как в табл. 1
names &lt;- c(&quot;Mawas&quot;, &quot;Kino&quot;, &quot;Jip&quot;, &quot;Deri&quot;, &quot;Jerry&quot;, &quot;Streisel&quot;, 
           &quot;Milo&quot;, &quot;Kondor&quot;, &quot;Juni&quot;, &quot;Kerry&quot;, &quot;Gismo&quot;, &quot;Preman&quot;)
# Порядок разных типов поведения с рис. 3
behaviours &lt;- c(&quot;NCU&quot;, &quot;APP&quot;, &quot;R&quot;, &quot;R+APP&quot;, &quot;S&quot;, &quot;S+APP&quot;)
# Время наблюдений из табл.1
days &lt;- c(10, 10, 10, 7, 10, 9, 7, 10, 5, 5, 4, 3)

# Добавляем информацию про число дней наблюдений
obs_time &lt;- data.frame(ID = names, days, stringsAsFactors = FALSE)
gap &lt;- left_join(gap, obs_time)

# Преобразуем в факторы и трансформируем то, что надо
gap &lt;- gap %&gt;% mutate(ID = factor(ID, levels = names), 
                      age = factor(age, levels = ages),
                      behaviour = factor(behaviour, levels = behaviours), 
                      takeoff = factor(takeoff), 
                      forearm_std = as.numeric(scale(forearm)))</code></pre>
</div>
<h2 id="-">Разведочный анализ</h2>
<p>Очень несбалансированные данные. По одному орангутану каждого возраста (и с соотв. длиной руки). Много наблюдений за каждым орангутаном, но есть не все сочетания типа поведения и опоры.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
with(gap, table(ID, behaviour, takeoff))</code></pre>
<pre><code>
, , takeoff = branch

          behaviour
ID         NCU APP   R R+APP   S S+APP
  Mawas     70   8   1     0   0     0
  Kino     299  74  62    21   1     0
  Jip      199 131  52    20   3     1
  Deri     133  73  30     9   3     5
  Jerry    231 114  51    13   2     0
  Streisel 225 145  31    21   0     1
  Milo     187  94  39     6   2     2
  Kondor   224 126  46    17   0     0
  Juni      92  30   9     6   0     0
  Kerry     85  54   3     3   0     0
  Gismo     39  39   4     0   0     0
  Preman    21  14   2     0   0     0

, , takeoff = liana

          behaviour
ID         NCU APP   R R+APP   S S+APP
  Mawas      6   1   1     0   0     0
  Kino      12   4  23     7   4     0
  Jip       13  10  47     9  21     4
  Deri       5   7  26     9   4     3
  Jerry     18  14  66    13   3     0
  Streisel   5   4  17     6   2     1
  Milo      12  11  56     8   3     1
  Kondor     9   6  45     4   4     0
  Juni       9   5  23     7   1     1
  Kerry      7   2   7     0   0     0
  Gismo      5   1  18     4   0     0
  Preman     3   1   5     1   0     0

, , takeoff = trunk

          behaviour
ID         NCU APP   R R+APP   S S+APP
  Mawas      0   1   1     0   1     0
  Kino      11  20  37    29   3     6
  Jip       38  28 135    53  38    17
  Deri      22  33 121    30  21    11
  Jerry     67  83 388    75  22    12
  Streisel  39  57 192    57   9     8
  Milo     112  69 293    52  22     5
  Kondor   153 112 550    84  14    11
  Juni     129  71 309    42   2     3
  Kerry     24  46 198    32   0     2
  Gismo    108  64 344    38   8     6
  Preman    67  30 156    26   6     2</code></pre>
</div>
<p>Нет выбросов у зависимой переменной <code>AGC</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
plot_grid(
  ggplot(gap, aes(x = forearm, y = 1:nrow(gap))) + geom_point(),
  ggplot(gap, aes(x = AGC, y = 1:nrow(gap))) + geom_point(),
  nrow = 1)</code></pre>
<p><img src="gap-crossing-orangutangs-zip-mv_files/figure-html5/dot-plot-1.png" width="624" /></p>
</div>
<p>Пропорция нулей невелика — всего 23 %.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
mean(gap$AGC == 0)</code></pre>
<pre><code>
[1] 0.227693</code></pre>
</div>
<h2 id="------">Воспроизведение части рисунков и анализов из статьи</h2>
<h3 id="fig.3">Fig.3</h3>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
# Рассчитаем относительную частоту перелезаний.
frec &lt;- gap %&gt;%
  mutate(age = as.character(age)) %&gt;% 
  group_by(ID, age, behaviour) %&gt;% 
  summarise(.n = n(), freq = .n/unique(days)) %&gt;% 
  ungroup() %&gt;% 
  mutate(age = factor(age, levels = ages))
# Собственно график №3
ggplot(data = frec, aes(x = age, y = freq, fill = behaviour)) + 
  geom_bar(stat = &#39;summary&#39;, fun.y = mean, position = position_dodge()) +
  scale_x_discrete(drop = FALSE)</code></pre>
<p><img src="gap-crossing-orangutangs-zip-mv_files/figure-html5/unnamed-chunk-2-1.png" width="624" /></p>
</div>
<h3 id="fig.4">Fig.4</h3>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
# Рассчитаем относительную частоту типов поддержки.
take &lt;- gap %&gt;%
  group_by(ID, age, takeoff) %&gt;% 
  summarise(.n = n(), 
            freq = .n/unique(days)) %&gt;% 
  ungroup() %&gt;% 
  mutate(age = factor(age, levels = ages))

# Fig.4
ggplot(data = take, aes(x = age, y = freq, fill = takeoff)) + 
  geom_bar(stat = &#39;summary&#39;, fun.y = mean, position = position_dodge()) +
  scale_x_discrete(drop = FALSE)</code></pre>
<p><img src="gap-crossing-orangutangs-zip-mv_files/figure-html5/unnamed-chunk-3-1.png" width="624" /></p>
</div>
<h3 id="table-2">Table 2</h3>
<h4 id="-">Наблюдаемые частоты</h4>
<p>Из-за того, что есть по два орангутана старших возрастов, наблюдаемые частоты разных типов поддержки по возрастам можно посчитать двумя способами.</p>
<h5 id="-1--">Способ 1: усреднение частот</h5>
<p>Можно сосчитать частоту для каждого ID, поделив на число дней для ID, затем усреднить частоты. Последняя строка в этом способе НЕ совпадает!!!</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
take1 &lt;- gap %&gt;%
  group_by(ID, age, takeoff) %&gt;% 
  summarise(.n = n(), 
            freq = .n/unique(days)) %&gt;% 
  group_by(age, takeoff) %&gt;%          # По возрастам и типам поддержки
  summarise(freq = mean(freq)) %&gt;%    # усредняем частоты
    ungroup() %&gt;% 
  mutate(age = factor(age, levels = ages)) %&gt;% 
    arrange(age)
t_obs1 &lt;- matrix(floor(take1$freq), nrow = 10, byrow = TRUE)
t_obs1</code></pre>
<pre><code>
      [,1] [,2] [,3]
 [1,]    7    0    0
 [2,]   45    5   10
 [3,]   40   10   30
 [4,]   36    7   34
 [5,]   41   11   64
 [6,]   47    3   40
 [7,]   47   13   79
 [8,]   41    6   92
 [9,]   28    6   85
[10,]   16    5  118</code></pre>
<pre class="r"><code>
# Хи-квадрат
chi_all1 &lt;- chisq.test(t_obs1)
round(chi_all1$expected, 3)</code></pre>
<pre><code>
        [,1]  [,2]   [,3]
 [1,]  2.522 0.478  4.000
 [2,] 21.615 4.099 34.286
 [3,] 28.820 5.466 45.714
 [4,] 27.739 5.261 44.000
 [5,] 41.789 7.925 66.286
 [6,] 32.422 6.149 51.429
 [7,] 50.075 9.497 79.429
 [8,] 50.075 9.497 79.429
 [9,] 42.870 8.130 68.000
[10,] 50.075 9.497 79.429</code></pre>
</div>
<h5 id="-2----">Способ 2: частоты по суммарным данным</h5>
<p>Можно суммировать число наблюдений и дней по возрастам, затем сосчитать общую частоту. Предпоследняя строка в этом способе НЕ совпадает!!! Ровно в 2 раза.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
take2 &lt;- gap %&gt;%
  group_by(age, takeoff) %&gt;% 
  summarise(.n = n(), 
            days = sum(unique(days)),
            freq = .n/days) %&gt;% 
  ungroup() %&gt;% 
  mutate(age = factor(age, levels = ages)) %&gt;% 
  arrange(age)
t_obs2 &lt;- matrix(floor(take2$freq), nrow = 10, byrow = TRUE)
t_obs2</code></pre>
<pre><code>
      [,1] [,2] [,3]
 [1,]    7    0    0
 [2,]   45    5   10
 [3,]   40   10   30
 [4,]   36    7   34
 [5,]   41   11   64
 [6,]   47    3   40
 [7,]   47   13   79
 [8,]   41    6   92
 [9,]   56   12  171
[10,]   17    5  122</code></pre>
<pre class="r"><code>
# Хи-квадрат
chi_all2 &lt;- chisq.test(t_obs2)
round(chi_all2$expected, 3)</code></pre>
<pre><code>
        [,1]   [,2]    [,3]
 [1,]  2.419  0.462   4.119
 [2,] 20.733  3.960  35.307
 [3,] 27.644  5.280  47.076
 [4,] 26.608  5.082  45.311
 [5,] 40.084  7.655  68.260
 [6,] 31.100  5.940  52.961
 [7,] 48.032  9.173  81.795
 [8,] 48.032  9.173  81.795
 [9,] 82.588 15.773 140.640
[10,] 49.760  9.503  84.737</code></pre>
</div>
<h4 id="----">Хи-квадрат как в статье</h4>
<p>Хи-квадрат в статье в табл.2 получен комбинацией обоих методов.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
# Матрица ожидаемых как в статье
t_obs_rounded &lt;- rbind(t_obs2[1:8, ], t_obs1[9, ], t_obs2[10, ])
colSums(t_obs_rounded)</code></pre>
<pre><code>
[1] 349  66 556</code></pre>
<pre class="r"><code>
rowSums(t_obs_rounded)</code></pre>
<pre><code>
 [1]   7  60  80  77 116  90 139 139 119 144</code></pre>
<pre class="r"><code>
# Без округления
t_obs &lt;- rbind(matrix(take2$freq, nrow = 10, byrow = TRUE)[1:8, ], 
               matrix(take1$freq, nrow = 10, byrow = TRUE)[9, ],
               matrix(take2$freq, nrow = 10, byrow = TRUE)[10, ])
colSums(t_obs)</code></pre>
<pre><code>
[1] 352.08571  70.63175 560.06508</code></pre>
<pre class="r"><code>
rowSums(t_obs)</code></pre>
<pre><code>
 [1]   9.00000  61.30000  81.90000  77.85714 117.20000  91.11111
 [7] 139.14286 140.50000 120.20000 144.57143</code></pre>
<pre class="r"><code>
# Хи-квадрат по таблице без округления - все совпало
chi_all &lt;- chisq.test(t_obs)
round(chi_all$expected, 3)</code></pre>
<pre><code>
        [,1]   [,2]   [,3]
 [1,]  3.224  0.647  5.129
 [2,] 21.961  4.406 34.933
 [3,] 29.341  5.886 46.673
 [4,] 27.893  5.596 44.369
 [5,] 41.987  8.423 66.790
 [6,] 32.641  6.548 51.922
 [7,] 49.848 10.000 79.294
 [8,] 50.335 10.098 80.068
 [9,] 43.062  8.639 68.499
[10,] 51.793 10.390 82.388</code></pre>
<pre class="r"><code>
# Посчитаем Пирсоновские остатки (В статье именно Пирсоновские)
round(resid(chi_all), 3)</code></pre>
<pre><code>
        [,1]   [,2]   [,3]
 [1,]  2.604  0.190 -2.132
 [2,]  5.066  0.283 -4.117
 [3,]  2.079  1.861 -2.309
 [4,]  1.562  0.896 -1.557
 [5,] -0.137  1.026 -0.256
 [6,]  2.513 -1.039 -1.624
 [7,] -0.383  0.949 -0.033
 [8,] -1.273 -1.038  1.378
 [9,] -2.265 -0.830  2.090
[10,] -4.835 -1.539  4.380</code></pre>
<pre class="r"><code>
round((t_obs - chi_all$expected) / sqrt(chi_all$expected), 3)</code></pre>
<pre><code>
        [,1]   [,2]   [,3]
 [1,]  2.604  0.190 -2.132
 [2,]  5.066  0.283 -4.117
 [3,]  2.079  1.861 -2.309
 [4,]  1.562  0.896 -1.557
 [5,] -0.137  1.026 -0.256
 [6,]  2.513 -1.039 -1.624
 [7,] -0.383  0.949 -0.033
 [8,] -1.273 -1.038  1.378
 [9,] -2.265 -0.830  2.090
[10,] -4.835 -1.539  4.380</code></pre>
<pre class="r"><code>
# # Стандартизованные остатки (Agresti, 2007, section 2.4.5 )
# chi_all$stdres</code></pre>
</div>
<h3 id="fig.6">Fig.6</h3>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ggplot(gap, aes(x = forearm, 
                y = (AGC * 100) / forearm, color = behaviour)) + 
  geom_point(position = position_jitter(width = 0.5))</code></pre>
<p><img src="gap-crossing-orangutangs-zip-mv_files/figure-html5/unnamed-chunk-7-1.png" width="624" /></p>
</div>
<h2 id="glmm---">GLMM с распределением Пуассона</h2>
<h3>Модель</h3>
<p>Традиционно можно было бы начать с GLMM, основанной на распределении Пуассона. Авторы пропускают этот шаг, и сразу подбирают ZIP GLMM отметив, что в данных много нулей. Мы пойдем по порядку.</p>
<p><span class="math inline">\(AGC_{ij} \sim Poisson(\mu_{ij})\)</span><br />
<span class="math inline">\(E(AGC_{ij}) = \mu_{ij}\)</span>, <span class="math inline">\(var(AGC_{ij}) = \mu_{ij}\)</span><br />
<span class="math inline">\(\begin{aligned}log(\mu_{ij}) = \beta_0 + \beta_{2}Behav_{APP\ ij} + \beta_{3}Behav_{R\ ij} + \\ + \beta_{4}Behav_{RAPP\ ij} + \beta_{5}Behav_{S\ ij} + \beta_{6}Behav_{SAPP\ ij} + \\ + \beta_{7}Sup_{liana\ ij} + \beta_{8}Sup_{trunk\ ij} + \beta_{9}Arm_{std\ ij} + \\ + \beta_{10}Behav_{APP\ ij}Sup_{liana\ ij} + \beta_{11}Behav_{R\ ij}Sup_{liana\ ij} + \\+ \beta_{12}Behav_{RAPP\ ij}Sup_{liana\ ij} + \beta_{13}Behav_{S\ ij}Sup_{liana\ ij} + \\ + \beta_{14}Behav_{SAPP\ ij}Sup_{liana\ ij} + \beta_{15}Behav_{APP\ ij}Sup_{trunk\ ij} + \\ + \beta_{16}Behav_{R\ ij}Sup_{trunk\ ij} + \beta_{17}Behav_{RAPP\ ij}Sup_{trunk\ ij} + \\ + \beta_{18}Behav_{S\ ij}Sup_{trunk\ ij} + \beta_{19}Behav_{SAPP\ ij}Sup_{trunk\ ij} + \\ + \beta_{20}Behav_{APP\ ij}Arm_{std\ ij} + \beta_{21}Behav_{R\ ij}Arm_{std\ ij} + \\ + \beta_{22}Behav_{RAPP\ ij}Arm_{std\ ij} + \beta_{23}Behav_{S\ ij}Arm_{std\ ij} + \\ + \beta_{24}Behav_{SAPP\ ij}Arm_{std\ ij} + \beta{25}Sup_{liana\ ij} Arm_{std\ ij} + \\ + \beta{26}Sup_{trunk\ ij} Arm_{std\ ij}ID_{j}\end{aligned}\)</span><br />
<span class="math inline">\(b_j \sim N(0, \sigma^2_{ID})\)</span></p>
<p>Последняя строчка этого уравнения в матричном виде, т.к. в модели довольно много коэффициентов, ведь в нее входят два дискретных предиктора <code>takeoff</code> (способ поддержки) <code>behaviour</code> (тип поведения), непрерывный предиктор <code>forearm_std</code> (стандартизованная длина предплечья) и все двухфакторные взаимодействия между ними.</p>
<p>Кроме того, в модели есть случайный эффект индивидуума <span class="math inline">\(b_j\)</span>.</p>
<p>Наконец, здесь лучше стандартизовать непрерывный предиктор и увеличить число итераций, чтобы модель сошлась.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
M1 &lt;- glmer(AGC ~ (behaviour + takeoff + forearm_std)^2 + (1|ID), 
            data = gap, family = &#39;poisson&#39;, 
            control = glmerControl(optimizer = &#39;bobyqa&#39;, 
                                   optCtrl = list(maxfun = 4e6)))</code></pre>
</div>
<h3 id="-">Диагностика модели</h3>
<p>Проверим, соответствует ли зависимость дисперсии и среднего тому, что можно ожидать при распределении Пуассона.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
overdisp(M1)</code></pre>
<pre><code>
# Overdispersion test

       dispersion ratio = 0.3507
  Pearson&#39;s Chi-Squared = 3024.4960
                p-value = 1.0000</code></pre>
</div>
<p>Сверхдисперсии нет! Можно было бы и дальше продолжать работать с этой моделью. Но, возможно, у нее есть еще другой недостаток. Нулей в данных сильно меньше, чем может предсказать Пуассоновская модель. Т.е. модель “перепредсказывает” число нулей.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
zero_count(M1)</code></pre>
<pre><code>
# Zero-Count overfitting

   Observed zero-counts: 1970
  Predicted zero-counts: 3536
                  Ratio: 1.79</code></pre>
</div>
<p>На графиках остатков не заметно ничего особенно подозрительного.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
M1_diag &lt;- data.frame(
  gap,
  .fitted = predict(M1, type = &quot;response&quot;),
  .pears_resid = residuals(M1, type = &quot;pearson&quot;))
plot_grid(
  ggplot(M1_diag, aes(x = .fitted, y = .pears_resid)) + geom_point() + geom_smooth(),
  ggplot(M1_diag, aes(x = forearm_std, y = .pears_resid)) + geom_point() + geom_smooth(),
  ggplot(M1_diag, aes(x = ID, y = .pears_resid)) + geom_boxplot(),
  ggplot(M1_diag, aes(x = behaviour, y = .pears_resid)) + geom_boxplot(),
  ggplot(M1_diag, aes(x = takeoff, y = .pears_resid)) + geom_boxplot(),
  nrow = 2)</code></pre>
<p><img src="gap-crossing-orangutangs-zip-mv_files/figure-html5/mod-pois-lme4-resid-1.png" width="624" /></p>
</div>
<p>Если мы посмотрим одновременно на остатки по типам поведения для разных орангутанов, то заметно, что модель плохо предсказывает AGC трех самых молодых орангутанов (большие остатки на графиках у величнт, для которых предсказано нулевое значение).</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ggplot(M1_diag, aes(x = .fitted, y = .pears_resid, colour = behaviour)) +
  geom_point(position = position_jitter(width = 0.1, height = 0.1), alpha = 0.3) +
  facet_wrap(~ ID)</code></pre>
<p><img src="gap-crossing-orangutangs-zip-mv_files/figure-html5/mod-pois-lme4-resid-categ-1.png" width="624" /></p>
</div>
<h3 id="-">Описание результатов</h3>
<p>Какая модель у нас получилась? Посмотрим на <code>summary()</code> и запишем уравнение.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
summary(M1)</code></pre>
<pre><code>
Generalized linear mixed model fit by maximum likelihood (Laplace
  Approximation) [glmerMod]
 Family: poisson  ( log )
Formula: AGC ~ (behaviour + takeoff + forearm_std)^2 + (1 | ID)
   Data: gap
Control: 
glmerControl(optimizer = &quot;bobyqa&quot;, optCtrl = list(maxfun = 4e+06))

     AIC      BIC   logLik deviance df.resid 
 17879.3  18070.1  -8912.7  17825.3     8625 

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-1.3627 -0.4577 -0.1330  0.2523  4.8779 

Random effects:
 Groups Name        Variance Std.Dev.
 ID     (Intercept) 0.02942  0.1715  
Number of obs: 8652, groups:  ID, 12

Fixed effects:
                            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                 -1.75343    0.07804 -22.470  &lt; 2e-16 ***
behaviourAPP                 1.56937    0.06870  22.845  &lt; 2e-16 ***
behaviourR                   1.80549    0.08273  21.823  &lt; 2e-16 ***
behaviourR+APP               2.17812    0.10052  21.669  &lt; 2e-16 ***
behaviourS                   2.26759    0.26709   8.490  &lt; 2e-16 ***
behaviourS+APP               2.00160    0.32475   6.163 7.12e-10 ***
takeoffliana                 0.93783    0.15800   5.936 2.93e-09 ***
takeofftrunk                 1.37737    0.07391  18.636  &lt; 2e-16 ***
forearm_std                  0.61254    0.05978  10.246  &lt; 2e-16 ***
behaviourAPP:takeoffliana   -0.76669    0.20391  -3.760 0.000170 ***
behaviourR:takeoffliana     -0.65590    0.17473  -3.754 0.000174 ***
behaviourR+APP:takeoffliana -0.88401    0.20189  -4.379 1.19e-05 ***
behaviourS:takeoffliana     -0.82329    0.32521  -2.532 0.011354 *  
behaviourS+APP:takeoffliana -0.30924    0.41177  -0.751 0.452650    
behaviourAPP:takeofftrunk   -1.26544    0.09064 -13.961  &lt; 2e-16 ***
behaviourR:takeofftrunk     -1.01379    0.09641 -10.515  &lt; 2e-16 ***
behaviourR+APP:takeofftrunk -1.30775    0.11624 -11.251  &lt; 2e-16 ***
behaviourS:takeofftrunk     -1.33913    0.27690  -4.836 1.32e-06 ***
behaviourS+APP:takeofftrunk -0.94894    0.33704  -2.815 0.004870 ** 
behaviourAPP:forearm_std    -0.16504    0.04445  -3.713 0.000205 ***
behaviourR:forearm_std      -0.27280    0.03725  -7.323 2.42e-13 ***
behaviourR+APP:forearm_std  -0.15313    0.04628  -3.309 0.000937 ***
behaviourS:forearm_std      -0.22330    0.07021  -3.180 0.001471 ** 
behaviourS+APP:forearm_std  -0.12873    0.08301  -1.551 0.120942    
takeoffliana:forearm_std    -0.27069    0.05501  -4.921 8.61e-07 ***
takeofftrunk:forearm_std    -0.23934    0.03837  -6.237 4.45e-10 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
<p><span class="math inline">\(AGC_{ij} \sim Poisson(\mu_{ij})\)</span><br />
<span class="math inline">\(E(AGC_{ij}) = \mu_{ij}\)</span>, <span class="math inline">\(var(AGC_{ij}) = \mu_{ij}\)</span><br />
<span class="math inline">\(\begin{aligned}log(\mu_{ij}) = -1.753 + 1.569 Behav_{APP\ ij} + 1.805 Behav_{R\ ij} + \\ + 2.178 Behav_{RAPP\ ij} + 2.268 Behav_{S\ ij} + 2.002 Behav_{SAPP\ ij} + \\ + 0.938 Sup_{liana\ ij} + 1.377 Sup_{trunk\ ij} + 0.613 Arm_{std\ ij} - \\ - 0.767 Behav_{APP\ ij}Sup_{liana\ ij} - 0.656 Behav_{R\ ij}Sup_{liana\ ij} - \\ - 0.884 Behav_{RAPP\ ij}Sup_{liana\ ij} - 0.823 Behav_{S\ ij}Sup_{liana\ ij} - \\ - 0.309 Behav_{SAPP\ ij}Sup_{liana\ ij} - 1.265 Behav_{APP\ ij}Sup_{trunk\ ij} - \\ - 1.014 Behav_{R\ ij}Sup_{trunk\ ij} - 1.308 Behav_{RAPP\ ij}Sup_{trunk\ ij} - \\ - 1.339 Behav_{S\ ij}Sup_{trunk\ ij} - 0.949 Behav_{SAPP\ ij}Sup_{trunk\ ij} - \\ - 0.165 Behav_{APP\ ij}Arm_{std\ ij} - 0.273 Behav_{R\ ij}Arm_{std\ ij} - \\ - 0.153 Behav_{RAPP\ ij}Arm_{std\ ij} - 0.223 Behav_{S\ ij}Arm_{std\ ij} - \\ - 0.129 Behav_{SAPP\ ij}Arm_{std\ ij} - 0.271 Sup_{liana\ ij} Arm_{std\ ij} - \\ - 0.239 Sup_{trunk\ ij} Arm_{std\ ij} + ID_{j}\end{aligned}\)</span><br />
<span class="math inline">\(b_j \sim N(0, \sigma^2_{ID})\)</span></p>
<p>Все взаимодействия, включенные в модель, оказались статистически значимыми (тесты отношения правдоподобий, <span class="math inline">\(p &lt; 0.01\)</span>). Т.е. длина пересекаемого промежутка между деревьями по-разному зависела от длины руки для разных типов поддержки и типов поведения. Так же на нее по-разному влиял тип поведения в зависимости от типа поддержки.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
drop1(M1, test = &quot;Chi&quot;)</code></pre>
<pre><code>
Single term deletions

Model:
AGC ~ (behaviour + takeoff + forearm_std)^2 + (1 | ID)
                      Df   AIC     LRT   Pr(Chi)    
&lt;none&gt;                   17879                      
behaviour:takeoff     10 18091 231.324 &lt; 2.2e-16 ***
behaviour:forearm_std  5 17929  59.493 1.547e-11 ***
takeoff:forearm_std    2 17916  40.341 1.738e-09 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
<p>Чтобы узнать, в чем именно заключались различия, можно было бы сделать пост-хок тест. Например, для орангутанов среднего размера (со средней длиной предплечья).</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
emmeans(M1, specs = pairwise ~ takeoff | behaviour, type = &#39;response&#39;)$contrasts</code></pre>
<pre><code>
behaviour = NCU:
 contrast           ratio         SE  df z.ratio p.value
 branch / liana 0.3914745 0.06185270 Inf  -5.936  &lt;.0001
 branch / trunk 0.2522407 0.01864315 Inf -18.636  &lt;.0001
 liana / trunk  0.6443348 0.09911774 Inf  -2.857  0.0119

behaviour = APP:
 contrast           ratio         SE  df z.ratio p.value
 branch / liana 0.8427026 0.10865518 Inf  -1.327  0.3799
 branch / trunk 0.8941099 0.04929109 Inf  -2.030  0.1050
 liana / trunk  1.0610028 0.13916044 Inf   0.451  0.8938

behaviour = R:
 contrast           ratio         SE  df z.ratio p.value
 branch / liana 0.7543226 0.05578785 Inf  -3.812  0.0004
 branch / trunk 0.6951803 0.04218786 Inf  -5.991  &lt;.0001
 liana / trunk  0.9215956 0.04512429 Inf  -1.668  0.2178

behaviour = R+APP:
 contrast           ratio         SE  df z.ratio p.value
 branch / liana 0.9475964 0.11892444 Inf  -0.429  0.9036
 branch / trunk 0.9327462 0.08286875 Inf  -0.784  0.7131
 liana / trunk  0.9843285 0.10028177 Inf  -0.155  0.9868

behaviour = S:
 contrast           ratio         SE  df z.ratio p.value
 branch / liana 0.8917728 0.25334967 Inf  -0.403  0.9143
 branch / trunk 0.9624817 0.25607467 Inf  -0.144  0.9887
 liana / trunk  1.0792902 0.15049593 Inf   0.547  0.8479

behaviour = S+APP:
 contrast           ratio         SE  df z.ratio p.value
 branch / liana 0.5333431 0.20255665 Inf  -1.655  0.2227
 branch / trunk 0.6515312 0.21374953 Inf  -1.306  0.3918
 liana / trunk  1.2215986 0.27872566 Inf   0.877  0.6547

P value adjustment: tukey method for comparing a family of 3 estimates 
Tests are performed on the log scale </code></pre>
</div>
<h3 id="--">График предсказаний модели</h3>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
new_data_M1 &lt;- gap %&gt;% group_by(behaviour, takeoff) %&gt;% 
  do(data.frame(forearm_std = unique(.$forearm_std), 
                forearm = unique(.$forearm))) %&gt;% 
  ungroup()

new_data_M1 &lt;- new_data_M1 %&gt;% 
  mutate(.fit = predict(M1, new_data_M1, type = &quot;response&quot;, re.form = NA))


ggplot(new_data_M1, aes(x = forearm, y = .fit, colour = takeoff)) +
  geom_point() + 
  geom_line() + 
  facet_wrap(~ behaviour) + 
  labs(y = &#39;Predicted AGC&#39;)</code></pre>
<p><img src="gap-crossing-orangutangs-zip-mv_files/figure-html5/mod-pois-predict-1.png" width="624" /></p>
</div>
<h2 id="zero-inflated-poisson-glmm----glmmadmb---">Zero Inflated Poisson GLMM, подобранная при помощи <code>glmmADMB</code> как в статье</h2>
<h3 id="-1">Модель</h3>
<p>Авторы статьи использовали Zero Inflated Poisson GLMM, мотивировав это наличием сверхдисперсии и большим числом нулей. Как мы это только что видели в предыдущей части, ситуация, скорее, обратная. Поэтому заранее можно предположить, что нам не поможет ZIP модель. Здесь мы ее обсудим только ради искусства.</p>
<p><span class="math inline">\(AGC_{ij} \sim ZIP(\mu_{ij}, \pi_{ij})\)</span><br />
<span class="math inline">\(E(AGC_{ij}) = (1 - \pi_{ij}) \mu_{ij}\)</span>, <span class="math inline">\(var(AGC_{ij}) = \mu_{ij} + \cfrac{\pi_{ij}}{(1 - \pi_{ij})} \mu_{ij}^2 = (1 - \pi_{ij}) \mu_{ij}(1 + \mu_{ij}\pi_{ij})\)</span><br />
<span class="math inline">\(logit(\pi_{ij}) = \beta_0\)</span><br />
<span class="math inline">\(log(\mu_{ij}) = \beta_0 + \beta_{2}Behav_{APP\ ij} + \beta_{3}Behav_{R\ ij} + \\ + \beta_{4}Behav_{RAPP\ ij} + \beta_{5}Behav_{S\ ij} + \beta_{6}Behav_{SAPP\ ij} + \\ + \beta_{7}Sup_{liana\ ij} + \beta_{8}Sup_{trunk\ ij} + \beta_{9}Arm_{std\ ij} + \\ + \beta_{10}Behav_{APP\ ij}Sup_{liana\ ij} + \beta_{11}Behav_{R\ ij}Sup_{liana\ ij} + \\+ \beta_{12}Behav_{RAPP\ ij}Sup_{liana\ ij} + \beta_{13}Behav_{S\ ij}Sup_{liana\ ij} + \\ + \beta_{14}Behav_{SAPP\ ij}Sup_{liana\ ij} + \beta_{15}Behav_{APP\ ij}Sup_{trunk\ ij} + \\ + \beta_{16}Behav_{R\ ij}Sup_{trunk\ ij} + \beta_{17}Behav_{RAPP\ ij}Sup_{trunk\ ij} + \\ + \beta_{18}Behav_{S\ ij}Sup_{trunk\ ij} + \beta_{19}Behav_{SAPP\ ij}Sup_{trunk\ ij} + \\ + \beta_{20}Behav_{APP\ ij}Arm_{std\ ij} + \beta_{21}Behav_{R\ ij}Arm_{std\ ij} + \\ + \beta_{22}Behav_{RAPP\ ij}Arm_{std\ ij} + \beta_{23}Behav_{S\ ij}Arm_{std\ ij} + \\ + \beta_{24}Behav_{SAPP\ ij}Arm_{std\ ij} + \beta{25}Sup_{liana\ ij} Arm_{std\ ij} + \\ + \beta{26}Sup_{trunk\ ij} Arm_{std\ ij}ID_{j}\)</span><br />
<span class="math inline">\(b_j \sim N(0, \sigma^2_{ID})\)</span></p>
<p><span class="math inline">\(\pi\)</span> — вероятность нуля из биномиальной части.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
# Z1 &lt;- glmmadmb(AGC ~ (behaviour + takeoff + forearm_std)^2 , 
# data = gap, family = &#39;poisson&#39;, zeroInflation = TRUE, random = ~ (1|ID))
# save(Z1, file = &#39;Z1.RData&#39;)
load(&#39;Z1.RData&#39;)</code></pre>
</div>
<h3 id="--1">Диагностика модели</h3>
<p>Проверка на сверхдисперсию.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
p &lt;- length(fixef(Z1)) + length(ranef(Z1)) + Z1$zeroInflation
sum(resid(Z1, type = &#39;pearson&#39;)^2) / (nrow(gap) - p)</code></pre>
<pre><code>
[1] 0.3506971</code></pre>
<pre class="r"><code>
# Вот как считает пирсоновские остатки glmmADMB
# Z1$residuals/Z1$sd.est, внутри знаменатель, видимо, считается как sqrt(mu):
# getAnywhere(residuals.glmmadmb)

# Сверхдисперсия вручную
# Пуассоновская часть
X_count &lt;- model.matrix(~ (behaviour + takeoff + forearm_std)^2, data = gap)
beta_count &lt;- fixef(Z1)
name_ID &lt;- as.numeric(factor(gap$ID, levels = names))
a &lt;- ranef(Z1)$ID
mu_count &lt;- exp(X_count %*% beta_count + a[name_ID])
# fitted(Z1) это на самом деле mu_count
# head(cbind(fitted(Z1), mu_count, E_y))
# Биномиальная часть отсутствует. Не понимаю, как
# это получается, но ее результаты уже включены в
# пуассоновскую часть
# И вот это уже можно не включать в расчеты
# pi_zi &lt;- exp(Z1$pz)/(1 + exp(Z1$pz))
# Считаем пирсоновские остатки вручную
# Формулы для матожидания и дисперсии будут
# использоваться для Пуассоновской части
# E(y) = mu
# Var(y) = mu
E_y &lt;- mu_count
Var_y &lt;- mu_count
# Пирсоновские остатки
e_pears &lt;- (gap$AGC - E_y) / sqrt(Var_y)
N &lt;- nrow(gap)
p &lt;- length(fixef(Z1)) + length(ranef(Z1)) + Z1$zeroInflation
sum(e_pears^2)/(N - p)</code></pre>
<pre><code>
[1] 0.3507115</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
# zero_count(Z1)
# Как установили во время рассчета степени сверхдисперсии, 
# биномиальная часть отсутствует.
mu_Z1 &lt;- predict(Z1, type = &quot;response&quot;)
# Предсказанное число нулей
(pred_zero &lt;- round(sum(dpois(x = 0, lambda = mu_Z1))))</code></pre>
<pre><code>
[1] 3636</code></pre>
<pre class="r"><code>
# Наблюдаемое число нулей
(obs_zero &lt;- sum(gap$AGC == 0))</code></pre>
<pre><code>
[1] 1970</code></pre>
<pre class="r"><code>
# Соотношение
pred_zero/obs_zero</code></pre>
<pre><code>
[1] 1.845685</code></pre>
</div>
<p>Графики остатков.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
Z1_diag &lt;- data.frame(
  gap,
  .fitted = predict(Z1, type = &quot;response&quot;),
  .pears_resid = residuals(Z1, type = &quot;pearson&quot;))
plot_grid(
  ggplot(Z1_diag, aes(x = .fitted, y = .pears_resid)) + geom_point() + geom_smooth(),
  ggplot(Z1_diag, aes(x = forearm_std, y = .pears_resid)) + geom_point() + geom_smooth(),
  ggplot(Z1_diag, aes(x = ID, y = .pears_resid)) + geom_boxplot(),
  ggplot(Z1_diag, aes(x = behaviour, y = .pears_resid)) + geom_boxplot(),
  ggplot(Z1_diag, aes(x = takeoff, y = .pears_resid)) + geom_boxplot(),
  nrow = 2)</code></pre>
<p><img src="gap-crossing-orangutangs-zip-mv_files/figure-html5/mod-zip-admb-resid-1.png" width="624" /></p>
</div>
<h3 id="--1">Описание результатов</h3>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
drop1(Z1)</code></pre>
<pre><code>
Single term deletions

Model:
AGC ~ (behaviour + takeoff + forearm_std)^2
                      Df   AIC
&lt;none&gt;                   17881
behaviour:takeoff     10 18093
behaviour:forearm_std  5 17931
takeoff:forearm_std    2 17918</code></pre>
</div>
<h3 id="---1">График предсказаний модели</h3>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
new_data_Z1 &lt;- gap %&gt;% group_by(behaviour, takeoff) %&gt;% 
  do(data.frame(forearm_std = unique(.$forearm_std), 
                forearm = unique(.$forearm))) %&gt;% 
  ungroup()

new_data_Z1 &lt;- new_data_Z1 %&gt;% 
  mutate(.fit = predict(Z1, new_data_Z1, type = &quot;response&quot;))


ggplot(new_data_Z1, aes(x = forearm, y = .fit, colour = takeoff)) +
  geom_point() + 
  geom_line() + 
  facet_wrap(~ behaviour) + 
  labs(y = &#39;Predicted AGC&#39;)</code></pre>
<p><img src="gap-crossing-orangutangs-zip-mv_files/figure-html5/mod-zip-admb-predict-1.png" width="624" /></p>
</div>
<h2 id="zero-inflated-poisson-glmm----glmmadmb----1">Zero Inflated Poisson GLMM, подобранная при помощи <code>glmmADMB</code> как в статье</h2>
<h3 id="-2">Модель</h3>
<p>Альтернативный вариант подбора ZIP GLMMM при помощи пакета <code>glmmTMB</code> гораздо более быстрый, но в нем нет многих полезных функций. Например, Пирсоновские остатки приходится считать вручную.</p>
<p>Формулу модели для сопоставимости можем взять такую же, как в модели для <code>glmmadmb()</code>, хотя <code>glmmTMB()</code> умеет подбирать и гораздо более сложные модели с предикторами и случайными эффектами в бинарной части модели.</p>
<p><span class="math inline">\(AGC_{ij} \sim ZIP(\mu_{ij}, \pi_{ij})\)</span><br />
<span class="math inline">\(E(AGC_{ij}) = (1 - \pi_{ij}) \mu_{ij}\)</span>, <span class="math inline">\(var(AGC_{ij}) = \mu_{ij} + \cfrac{\pi_{ij}}{(1 - \pi_{ij})} \mu_{ij}^2 = (1 - \pi_{ij}) \mu_{ij}(1 + \mu_{ij}\pi_{ij})\)</span><br />
<span class="math inline">\(logit(\pi_{ij}) = \beta_0\)</span><br />
<span class="math inline">\(log(\mu_{ij}) = \beta_0 + \beta_{2}Behav_{APP\ ij} + \beta_{3}Behav_{R\ ij} + \\ + \beta_{4}Behav_{RAPP\ ij} + \beta_{5}Behav_{S\ ij} + \beta_{6}Behav_{SAPP\ ij} + \\ + \beta_{7}Sup_{liana\ ij} + \beta_{8}Sup_{trunk\ ij} + \beta_{9}Arm_{std\ ij} + \\ + \beta_{10}Behav_{APP\ ij}Sup_{liana\ ij} + \beta_{11}Behav_{R\ ij}Sup_{liana\ ij} + \\+ \beta_{12}Behav_{RAPP\ ij}Sup_{liana\ ij} + \beta_{13}Behav_{S\ ij}Sup_{liana\ ij} + \\ + \beta_{14}Behav_{SAPP\ ij}Sup_{liana\ ij} + \beta_{15}Behav_{APP\ ij}Sup_{trunk\ ij} + \\ + \beta_{16}Behav_{R\ ij}Sup_{trunk\ ij} + \beta_{17}Behav_{RAPP\ ij}Sup_{trunk\ ij} + \\ + \beta_{18}Behav_{S\ ij}Sup_{trunk\ ij} + \beta_{19}Behav_{SAPP\ ij}Sup_{trunk\ ij} + \\ + \beta_{20}Behav_{APP\ ij}Arm_{std\ ij} + \beta_{21}Behav_{R\ ij}Arm_{std\ ij} + \\ + \beta_{22}Behav_{RAPP\ ij}Arm_{std\ ij} + \beta_{23}Behav_{S\ ij}Arm_{std\ ij} + \\ + \beta_{24}Behav_{SAPP\ ij}Arm_{std\ ij} + \beta{25}Sup_{liana\ ij} Arm_{std\ ij} + \\ + \beta{26}Sup_{trunk\ ij} Arm_{std\ ij}ID_{j}\)</span><br />
<span class="math inline">\(b_j \sim N(0, \sigma^2_{ID})\)</span></p>
<p><span class="math inline">\(\pi\)</span> — вероятность нуля из биномиальной части.</p>
<div class="layout-chunk" data-layout="l-body">
<pre><code>
# Overdispersion test

       dispersion ratio = 0.3507
  Pearson&#39;s Chi-Squared = 3024.5086
                p-value = 1.0000</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
B1 &lt;- glmmTMB(AGC ~ (behaviour + takeoff + forearm_std)^2 + (1|ID), data = gap, family = poisson, ziformula = ~ 1)</code></pre>
</div>
<h3 id="--2">Диагностика модели</h3>
<p>Проверка на сверхдисперсию.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
# пирсоновские остатки не считаются
# resid(B1, type = &#39;pearson&#39;)
# overdisp(B1)
# Сверхдисперсия вручную
# Пуассоновская часто
X_count &lt;- model.matrix(~ (behaviour + takeoff + forearm_std)^2, data = gap)
beta_count &lt;- fixef(B1)$cond
name_ID &lt;- as.numeric(factor(gap$ID, levels = names))
a &lt;- ranef(B1)$cond$ID
mu_count &lt;- exp(X_count %*% beta_count + a[name_ID,])
# Биномиальная часть
X_zi &lt;- model.matrix(~ 1, data = gap)
beta_zi &lt;- fixef(B1)$zi
pi_zi &lt;- exp(X_zi %*% beta_zi)/(1 + exp(X_zi %*% beta_zi))
# Считаем пирсоновские остатки вручную
# Формулы для матожидания и дисперсии
# E(y) = (1 - pi) * mu
# Var(y) = mu + pi / (1 - pi) *  mu^2 
# Кстати, это то же самое, что Var(y) = (1−π)μ(1+μπ)
E_y &lt;- (1 - pi_zi) * mu_count
Var_y &lt;- mu_count + pi_zi  / (1 - pi_zi) * mu_count^2
# Пирсоновские остатки
e_pears &lt;- (gap$AGC - E_y) / sqrt(Var_y)
# Сверхдисперсия
N &lt;- nrow(gap)
p &lt;- length(fixef(B1)$cond) + length(fixef(B1)$zi) + 1
sum(e_pears^2)/(N - p)</code></pre>
<pre><code>
[1] 0.3507062</code></pre>
<pre class="r"><code>
# Ок</code></pre>
</div>
<p>Графики остатков</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
B1_diag &lt;- data.frame(
  gap,
  .fitted = predict(B1, type = &quot;response&quot;),
  .pears_resid = e_pears)
plot_grid(
  ggplot(B1_diag, aes(x = .fitted, y = .pears_resid)) + geom_point() + geom_smooth(),
  ggplot(B1_diag, aes(x = forearm_std, y = .pears_resid)) + geom_point() + geom_smooth(),
  ggplot(B1_diag, aes(x = ID, y = .pears_resid)) + geom_boxplot(),
  ggplot(B1_diag, aes(x = behaviour, y = .pears_resid)) + geom_boxplot(),
  ggplot(B1_diag, aes(x = takeoff, y = .pears_resid)) + geom_boxplot(),
  nrow = 2)</code></pre>
<p><img src="gap-crossing-orangutangs-zip-mv_files/figure-html5/mod-zip-tmb-resid-1.png" width="624" /></p>
</div>
<h3 id="--2">Описание результатов</h3>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
# drop1(B1)</code></pre>
</div>
<h3 id="-">График предсказаний</h3>
<h4 id="---">С учетом случайного эффекта</h4>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
new_data_B1_re &lt;- gap %&gt;% group_by(ID, behaviour, takeoff) %&gt;% 
  do(data.frame(forearm_std = unique(.$forearm_std), 
                forearm = unique(.$forearm))) %&gt;% 
  ungroup()

new_data_B1_re &lt;- new_data_B1_re %&gt;% 
  mutate(.fit = predict(B1, new_data_B1_re, type = &quot;response&quot;))

ggplot(new_data_B1_re, aes(x = forearm, y = .fit, colour = takeoff)) +
  geom_point() + 
  geom_line() + 
  facet_wrap(~ behaviour) + 
  labs(y = &#39;Predicted AGC with ran.ef.&#39;)</code></pre>
<p><img src="gap-crossing-orangutangs-zip-mv_files/figure-html5/mod-zip-tmb-predict-re-1.png" width="624" /></p>
</div>
<h4 id="---">Без учета случайного эффекта</h4>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
# Делаем вручную, т.к. или только со случайным эффектом, или ошибка
# Error in predict.glmmTMB(B1, new_data_B1, type = &quot;response&quot;, re.form = NA) : 
  # re.form not yet implemented

new_data_B1 &lt;- gap %&gt;% group_by(behaviour, takeoff) %&gt;% 
  do(data.frame(forearm_std = unique(.$forearm_std), 
                forearm = unique(.$forearm))) %&gt;% 
  ungroup()

# Счетная часть
X_count &lt;- model.matrix(~ (behaviour + takeoff + forearm_std)^2, data = new_data_B1)
betas_count &lt;- fixef(B1)$cond
mu_count &lt;- exp(X_count %*% betas_count)

# Бинарная часть
X_bin &lt;- model.matrix(~ 1, data = new_data_B1)
betas_bin &lt;- fixef(B1)$zi
inv_logit &lt;- function(x) exp(x)/(1 + exp(x))
pi_bin &lt;- inv_logit(X_bin %*% betas_bin)

# E(y) = (1 - pi) * mu
new_data &lt;- .fit &lt;- (1 - pi_bin) * mu_count


ggplot(new_data_B1, aes(x = forearm, y = .fit, colour = takeoff)) +
  geom_point() + 
  geom_line() + 
  facet_wrap(~ behaviour) + 
  labs(y = &#39;Predicted AGC with ran.ef.&#39;)</code></pre>
<p><img src="gap-crossing-orangutangs-zip-mv_files/figure-html5/mod-zip-tmb-predict-1.png" width="624" /></p>
</div>
<h2 id="--">Сравнение оценок коэффициентов</h2>
<p>Модели разных типов и подобранные при помощи разных пакетов дают поразительно похожие оценки коэффициентов фиксированной части.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
dwplot(list(M1, Z1, B1), effects = &#39;fixed&#39;)</code></pre>
<p><img src="gap-crossing-orangutangs-zip-mv_files/figure-html5/unnamed-chunk-9-1.png" width="624" /></p>
</div>
<h2 id="todo---">TODO: Выводы из анализа</h2>
<h2 id="--todo">Что дальше? (TODO)</h2>
<ol type="1">
<li>Для полноты картины не хватает доверительных зон на графиках предсказаний.</li>
<li>Нужна валидация моделей при помощи симуляций, чтобы проверить, насколько хорошо они предсказывают не только нули, но и другие значения.</li>
<li>Нужны ссылки на литературу или список рекомендованной литературы.</li>
<li>Пуассоновская GLMM, о которой говорили выше, предсказывает слишком много нулей по сравнению с тем, что есть в данных. Естественно, использование ZIP модели не поможет исправить ситуацию. Можно попробовать подобрать Zero-altered Poisson модель (ZAP, Poisson hurdle-model). Другой пост?</li>
</ol>
<div id="refs" class="references">
<div id="ref-chappell2015ontogeny">
<p>Chappell, J., Phillips, A. C., Noordwijk, M. A. van, Setia, T. M., &amp; Thorpe, S. K. (2015). The ontogeny of gap crossing behaviour in bornean orangutans (pongo pygmaeus wurmbii). <em>PloS One</em>, <em>10</em>(7), e0130291.</p>
</div>
</div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<script id="distill-bibliography" type="text/bibtex">
@article{chappell2015ontogeny,
  title={The ontogeny of gap crossing behaviour in bornean orangutans (Pongo pygmaeus wurmbii)},
  author={Chappell, Jackie and Phillips, Abigail C and van Noordwijk, Maria A and Setia, Tatang Mitra and Thorpe, Susannah KS},
  journal={PloS one},
  volume={10},
  number={7},
  pages={e0130291},
  year={2015},
  publisher={Public Library of Science}
}
</script>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
